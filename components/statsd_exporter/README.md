# statsd_exporter
`statsd_exporter` is used to receive the metrics (in `statsd` format) from [`Envoy`](https://www.envoyproxy.io/docs/envoy/latest/operations/admin), 
and transform the metrics into [`Prometheus`](https://prometheus.io) format.

We will build a docker image for `stats_exporter` with [some customerization](https://github.com/songbinliu/statsd_exporter/tree/k8s):
* Providing a debug mode: log the number of metrics;
* Setting the default mapping for timer metrics to `Prometheus` histogram.

# Run the docker image

Run in debug mode:
```bash
docker run -d -p 8125:9125/udp -p 9102:9102 beekman9527/statsd_exporter --debug=true --interval=10
```
`interval=10` means that it will print the counter every 10 metrics.

Run in non-debug mode:
```bash
docker run -d -p 8125:9125/udp -p 9102:9102 beekman9527/statsd_exporter
```

# Access the metrics
The metrics can be accessed through `http://hostIP:9102/metrics`, the endpoint which `Prometheus` can scrape to collect metrics.

Here are some samples of the metrics:

```terminal
...
envoy_cluster_manager_total_clusters 1
# HELP envoy_cluster_video_service_external_upstream_rq_200 Metric autogenerated by statsd_exporter.
# TYPE envoy_cluster_video_service_external_upstream_rq_200 counter
envoy_cluster_video_service_external_upstream_rq_200 113
# HELP envoy_cluster_video_service_external_upstream_rq_2xx Metric autogenerated by statsd_exporter.
# TYPE envoy_cluster_video_service_external_upstream_rq_2xx counter
envoy_cluster_video_service_external_upstream_rq_2xx 113
# HELP envoy_cluster_video_service_external_upstream_rq_time Metric autogenerated by statsd_exporter.
# TYPE envoy_cluster_video_service_external_upstream_rq_time summary
envoy_cluster_video_service_external_upstream_rq_time{quantile="0.5"} 104
envoy_cluster_video_service_external_upstream_rq_time{quantile="0.9"} 107
envoy_cluster_video_service_external_upstream_rq_time{quantile="0.99"} 109
envoy_cluster_video_service_external_upstream_rq_time_sum 11811
envoy_cluster_video_service_external_upstream_rq_time_count 114
# HELP envoy_cluster_video_service_membership_healthy Metric autogenerated by statsd_exporter.
# TYPE envoy_cluster_video_service_membership_healthy gauge
envoy_cluster_video_service_membership_healthy 1
# HELP envoy_cluster_video_service_membership_total Metric autogenerated by statsd_exporter.
# TYPE envoy_cluster_video_service_membership_total gauge
envoy_cluster_video_service_membership_total 1
# HELP envoy_cluster_video_service_upstream_cx_active Metric autogenerated by statsd_exporter.
# TYPE envoy_cluster_video_service_upstream_cx_active gauge
envoy_cluster_video_service_upstream_cx_active 2
# HELP envoy_cluster_video_service_upstream_cx_connect_ms Metric autogenerated by statsd_exporter.
# TYPE envoy_cluster_video_service_upstream_cx_connect_ms summary
envoy_cluster_video_service_upstream_cx_connect_ms{quantile="0.5"} 0
envoy_cluster_video_service_upstream_cx_connect_ms{quantile="0.9"} 0
envoy_cluster_video_service_upstream_cx_connect_ms{quantile="0.99"} 0
envoy_cluster_video_service_upstream_cx_connect_ms_sum 0
envoy_cluster_video_service_upstream_cx_connect_ms_count 49
# HELP envoy_cluster_video_service_upstream_cx_http1_total Metric autogenerated by statsd_exporter.
# TYPE envoy_cluster_video_service_upstream_cx_http1_total counter
envoy_cluster_video_service_upstream_cx_http1_total 48
# HELP envoy_cluster_video_service_upstream_cx_length_ms Metric autogenerated by statsd_exporter.
# TYPE envoy_cluster_video_service_upstream_cx_length_ms summary
envoy_cluster_video_service_upstream_cx_length_ms{quantile="0.5"} 7289
envoy_cluster_video_service_upstream_cx_length_ms{quantile="0.9"} 13858
envoy_cluster_video_service_upstream_cx_length_ms{quantile="0.99"} 22548
envoy_cluster_video_service_upstream_cx_length_ms_sum 406103
envoy_cluster_video_service_upstream_cx_length_ms_count 47
# HELP envoy_cluster_video_service_upstream_cx_rx_bytes_buffered Metric autogenerated by statsd_exporter.
# TYPE envoy_cluster_video_service_upstream_cx_rx_bytes_buffered gauge
envoy_cluster_video_service_upstream_cx_rx_bytes_buffered 977
# HELP envoy_cluster_video_service_upstream_cx_rx_bytes_total Metric autogenerated by statsd_exporter.
# TYPE envoy_cluster_video_service_upstream_cx_rx_bytes_total counter
envoy_cluster_video_service_upstream_cx_rx_bytes_total 55212
# HELP envoy_cluster_video_service_upstream_cx_total Metric autogenerated by statsd_exporter.
# TYPE envoy_cluster_video_service_upstream_cx_total counter
envoy_cluster_video_service_upstream_cx_total 48
...
```
